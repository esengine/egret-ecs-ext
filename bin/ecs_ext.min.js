window.es={},window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();var __awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}c((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};!function(t){var e=function(e){function i(n,r,o){void 0===o&&(o=!0);var s=e.call(this)||this;return s._globalManagers=[],s._coroutineManager=new t.CoroutineManager,s._timerManager=new t.TimerManager,s._frameCounterElapsedTime=0,s._frameCounter=0,s._totalMemory=0,s.width=n,s.height=r,i._instance=s,i.emitter=new t.Emitter,i.emitter.addObserver(t.CoreEvents.FrameUpdated,s.update,s),i.registerGlobalManager(s._coroutineManager),i.registerGlobalManager(s._timerManager),i.entitySystemsEnabled=o,s.initialize(),s}return __extends(i,e),Object.defineProperty(i,"Instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(i,"scene",{get:function(){return this._instance?this._instance._scene:null},set:function(t){t?null==this._instance._scene?(this._instance._scene=t,this._instance.onSceneChanged(),this._instance._scene.begin()):this._instance._nextScene=t:console.error("场景不能为空")},enumerable:!0,configurable:!0}),i.registerGlobalManager=function(t){this._instance._globalManagers.push(t),t.enabled=!0},i.unregisterGlobalManager=function(t){new linq.List(this._instance._globalManagers).remove(t),t.enabled=!1},i.getGlobalManager=function(t){for(var e=0;e<this._instance._globalManagers.length;e++)if(this._instance._globalManagers[e]instanceof t)return this._instance._globalManagers[e];return null},i.startCoroutine=function(t){return this._instance._coroutineManager.startCoroutine(t)},i.schedule=function(t,e,i,n){return void 0===e&&(e=!1),void 0===i&&(i=null),this._instance._timerManager.schedule(t,e,i,n)},i.prototype.onOrientationChanged=function(){i.emitter.emit(t.CoreEvents.OrientationChanged)},i.prototype.startDebugDraw=function(){if(this._frameCounter++,this._frameCounterElapsedTime+=t.Time.deltaTime,this._frameCounterElapsedTime>=1){var e=window.performance.memory;null!=e&&(this._totalMemory=Number((e.totalJSHeapSize/1048576).toFixed(2))),this._titleMemory&&this._titleMemory(this._totalMemory,this._frameCounter),this._frameCounter=0,this._frameCounterElapsedTime-=1}},i.prototype.onSceneChanged=function(){i.emitter.emit(t.CoreEvents.SceneChanged),t.Time.sceneChanged(),i.emitter.emit(t.CoreEvents.CallGC)},i.prototype.onGraphicsDeviceReset=function(){null!=this._graphicsDeviceChangeTimer?this._graphicsDeviceChangeTimer.reset():this._graphicsDeviceChangeTimer=i.schedule(.05,!1,this,function(e){e.context._graphicsDeviceChangeTimer=null,i.emitter.emit(t.CoreEvents.GraphicsDeviceReset)})},i.prototype.initialize=function(){i.graphicsDevice=new t.GraphicsDevice(this.stage.stageWidth,this.stage.stageHeight),t.Graphics.instance=new t.Graphics},i.prototype.update=function(e){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){if(null!=e&&t.Time.update(e),null!=this._scene){for(n=this._globalManagers.length-1;n>=0;n--)this._globalManagers[n].enabled&&this._globalManagers[n].update();i.useCustomUpdate?i.emitter.emit(t.CoreEvents.SceneUpdated):null!=this._sceneTransition&&(null==this._sceneTransition||this._sceneTransition._loadsNewScene&&!this._sceneTransition._isNewSceneLoaded)||this._scene.update(),null!=this._nextScene&&(this._scene.end(),this._scene=this._nextScene,this._nextScene=null,this.onSceneChanged(),this._scene.begin())}return this.startDebugDraw(),i.emitter.emit(t.CoreEvents.CallDraw),[2]})})},i.pauseOnFocusLost=!0,i.debugRenderEndabled=!1,i.useCustomUpdate=!1,i}(egret.DisplayObjectContainer);t.Core=e}(es||(es={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(t,e,n){return void 0===e&&(e=null),void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return e?RES.isGroupLoaded(e)?[3,2]:[4,RES.loadGroup(e,0,new i(n))]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,RES.getResAsync(t)];case 3:return[2,r.sent()]}})})},e}(t.GlobalManager);t.AssetManager=e;var i=function(){function t(t){this.assetUserTask=t}return t.prototype.onProgress=function(t,e,i){this.assetUserTask&&this.assetUserTask(t,e,i)},t}();t.AssetTaskReport=i}(es||(es={})),function(t){var e=function(){return function(t,e){void 0===e&&(e=10),this.sprites=t,this.frameRate=e}}();t.SpriteAnimation=e}(es||(es={})),function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._inset={left:0,right:0,top:0,bottom:0},i._bounds=new t.Rectangle,i._transformMatrix=t.Matrix2D.identity,i._inverseTransformMatrix=t.Matrix2D.identity,i._origin=t.Vector2.zero,i._minimumZoom=.3,i._zoom=0,i._maximumZoom=3,i._areMatrixedDirty=!0,i._areBoundsDirty=!0,i._isProjectionMatrixDirty=!0,i.setZoom(0),i}return __extends(i,e),Object.defineProperty(i.prototype,"position",{get:function(){return this.entity.transform.position},set:function(t){this.entity.transform.position=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this.entity.transform.rotation},set:function(t){this.entity.transform.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawZoom",{get:function(){return this._zoom},set:function(t){t!=this._zoom&&(this._zoom=t,this._areMatrixedDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zoom",{get:function(){return 0==this._zoom?1:this._zoom<1?t.MathHelper.map(this._zoom,this._minimumZoom,1,-1,0):t.MathHelper.map(this._zoom,1,this._maximumZoom,0,1)},set:function(t){this.setZoom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minimumZoom",{get:function(){return this._minimumZoom},set:function(t){this.setMinimumZoom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maximumZoom",{get:function(){return this._maximumZoom},set:function(t){this.setMaximumZoom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bounds",{get:function(){if(this._areMatrixedDirty&&this.updateMatrixes(),this._areBoundsDirty){var e=this.screenToWorldPoint(new t.Vector2(this._inset.left,this._inset.top)),i=this.screenToWorldPoint(new t.Vector2(t.Core.Instance.width-this._inset.right,t.Core.Instance.height-this._inset.bottom));if(0!=this.entity.transform.rotation){var n=this.screenToWorldPoint(new t.Vector2(t.Core.Instance.width-this._inset.right,this._inset.top)),r=this.screenToWorldPoint(new t.Vector2(this._inset.left,t.Core.Instance.height-this._inset.bottom)),o=Math.min(e.x,i.x,n.x,r.x),s=Math.max(e.x,i.x,n.x,r.x),a=Math.min(e.y,i.y,n.y,r.y),c=Math.max(e.y,i.y,n.y,r.y);this._bounds.location=new t.Vector2(o,a),this._bounds.width=s-o,this._bounds.height=c-a}else this._bounds.location=e,this._bounds.width=i.x-e.x,this._bounds.height=i.y-e.y;this._areBoundsDirty=!1}return this._bounds},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transformMatrix",{get:function(){return this._areMatrixedDirty&&this.updateMatrixes(),this._transformMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inverseTransformMatrix",{get:function(){return this._areMatrixedDirty&&this.updateMatrixes(),this._inverseTransformMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"projectionMatrix",{get:function(){return this._isProjectionMatrixDirty&&(t.Matrix.createOrthographicOffCenter(0,t.Core.graphicsDevice.viewport.width,t.Core.graphicsDevice.viewport.height,0,0,-1,this._projectionMatrix),this._isProjectionMatrixDirty=!1),this._projectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewprojectionMatrix",{get:function(){return t.Matrix.multiply(t.Matrix2D.toMatrix(this.transformMatrix),this.projectionMatrix),this.projectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"origin",{get:function(){return this._origin},set:function(t){this._origin!=t&&(this._origin=t,this._areMatrixedDirty=!0)},enumerable:!0,configurable:!0}),i.prototype.setInset=function(t,e,i,n){return this._inset={left:t,right:e,top:i,bottom:n},this._areBoundsDirty=!0,this},i.prototype.setPosition=function(t){return this.entity.transform.setPosition(t.x,t.y),this},i.prototype.setRotation=function(t){return this.entity.transform.setRotation(t),this},i.prototype.setZoom=function(e){var i=t.MathHelper.clamp(e,-1,1);return this._zoom=0==i?1:i<0?t.MathHelper.map(i,-1,0,this._minimumZoom,1):t.MathHelper.map(i,0,1,1,this._maximumZoom),this._areMatrixedDirty=!0,this},i.prototype.setMinimumZoom=function(e){return t.Insist.isTrue(e>0,"minimumZoom必须大于零"),this._zoom<e&&(this._zoom=this.minimumZoom),this._minimumZoom=e,this},i.prototype.setMaximumZoom=function(e){return t.Insist.isTrue(e>0,"MaximumZoom必须大于零"),this._zoom>e&&(this._zoom=e),this._maximumZoom=e,this},i.prototype.forceMatrixUpdate=function(){this._areMatrixedDirty=!0},i.prototype.onEntityTransformChanged=function(t){this._areMatrixedDirty=!0},i.prototype.zoomIn=function(t){this.zoom+=t},i.prototype.zoomOut=function(t){this.zoom-=t},i.prototype.worldToScreenPoint=function(e){return this.updateMatrixes(),t.Vector2Ext.transformR(e,this._transformMatrix,e),e},i.prototype.screenToWorldPoint=function(e){return this.updateMatrixes(),t.Vector2Ext.transformR(e,this._inverseTransformMatrix,e),e},i.prototype.onSceneRenderTargetSizeChanged=function(e,i){this._isProjectionMatrixDirty=!0;var n=this._origin.clone();this.origin=new t.Vector2(e/2,i/2),this.entity.position=t.Vector2.add(this.entity.position,t.Vector2.subtract(this._origin,n))},i.prototype.updateMatrixes=function(){var e;this._areMatrixedDirty&&(this._transformMatrix=t.Matrix2D.createTranslation(-this.entity.transform.position.x,-this.entity.transform.position.y),1!=this._zoom&&(e=t.Matrix2D.createScale(this._zoom,this._zoom),this._transformMatrix=this._transformMatrix.multiply(e)),0!=this.entity.transform.rotation&&(e=t.Matrix2D.createRotation(this.entity.transform.rotation),this._transformMatrix=this._transformMatrix.multiply(e)),e=t.Matrix2D.createTranslation(this._origin.x,this._origin.y),this._transformMatrix=this._transformMatrix.multiply(e),this._inverseTransformMatrix=t.Matrix2D.invert(this._transformMatrix),this._areBoundsDirty=!0,this._areMatrixedDirty=!1)},i}(t.Component);t.Camera=e}(es||(es={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i._shakeDirection=t.Vector2.zero,i._shakeOffset=t.Vector2.zero,i._shakeIntensity=0,i._shakeDegredation=.95,i}return __extends(i,e),i.prototype.shake=function(e,i,n){void 0===e&&(e=15),void 0===i&&(i=.9),void 0===n&&(n=t.Vector2.zero),this.enabled=!0,this._shakeIntensity<e&&(this._shakeDirection=n,this._shakeIntensity=e,(i<0||i>=1)&&(i=.95),this._shakeDegredation=i)},i.prototype.update=function(){Math.abs(this._shakeIntensity)>0&&(this._shakeOffset=this._shakeDirection,0!=this._shakeOffset.x||0!=this._shakeOffset.y?this._shakeOffset.normalize():(this._shakeOffset.x=this._shakeOffset.x+Math.random()-.5,this._shakeOffset.y=this._shakeOffset.y+Math.random()-.5),this._shakeOffset.multiply(new t.Vector2(this._shakeIntensity)),this._shakeIntensity*=-this._shakeDegredation,Math.abs(this._shakeIntensity)<=.01&&(this._shakeIntensity=0,this.enabled=!1))},i}(t.Component);t.CameraShake=e}(es||(es={})),function(t){var e;!function(t){t[t.lockOn=0]="lockOn",t[t.cameraWindow=1]="cameraWindow"}(e=t.CameraStyle||(t.CameraStyle={}));var i=function(i){function n(n,r,o){void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=e.lockOn);var s=i.call(this)||this;return s.followLerp=.1,s.deadzone=new t.Rectangle,s.focusOffset=t.Vector2.zero,s.mapLockEnabled=!1,s.mapSize=new t.Rectangle,s._desiredPositionDelta=new t.Vector2,s._worldSpaceDeadZone=new t.Rectangle,s._targetEntity=n,s._cameraStyle=o,s.camera=r,s}return __extends(n,i),n.prototype.onAddedToEntity=function(){null==this.camera&&(this.camera=this.entity.getOrCreateComponent(t.Camera)),this.follow(this._targetEntity,this._cameraStyle),t.Core.emitter.addObserver(t.CoreEvents.GraphicsDeviceReset,this.onGraphicsDeviceReset,this)},n.prototype.onGraphicsDeviceReset=function(){t.Core.schedule(0,!1,this,function(t){var e=t.context;e.follow(e._targetEntity,e._cameraStyle)})},n.prototype.update=function(){var e=t.Vector2.multiply(this.camera.bounds.size,new t.Vector2(.5));this._worldSpaceDeadZone.x=this.camera.position.x-e.x+this.deadzone.x+this.focusOffset.x,this._worldSpaceDeadZone.y=this.camera.position.y-e.y+this.deadzone.y+this.focusOffset.y,this._worldSpaceDeadZone.width=this.deadzone.width,this._worldSpaceDeadZone.height=this.deadzone.height,this._targetEntity&&this.updateFollow(),this.camera.position=t.Vector2.lerp(this.camera.position,t.Vector2.add(this.camera.position,this._desiredPositionDelta),this.followLerp),this.entity.transform.roundPosition(),this.mapLockEnabled&&(this.camera.position=this.clampToMapSize(this.camera.position),this.entity.transform.roundPosition())},n.prototype.clampToMapSize=function(e){var i=t.Vector2.multiply(this.camera.bounds.size,new t.Vector2(.5)).add(new t.Vector2(this.mapSize.x,this.mapSize.y)),n=new t.Vector2(this.mapSize.width-i.x,this.mapSize.height-i.y);return t.Vector2.clamp(e,i,n)},n.prototype.follow=function(i,n){void 0===n&&(n=e.cameraWindow),this._targetEntity=i,this._cameraStyle=n;var r=this.camera.bounds;switch(this._cameraStyle){case e.cameraWindow:var o=r.width/6,s=r.height/3;this.deadzone=new t.Rectangle((r.width-o)/2,(r.height-s)/2,o,s);break;case e.lockOn:this.deadzone=new t.Rectangle(r.width/2,r.height/2,10,10)}},n.prototype.updateFollow=function(){if(this._desiredPositionDelta.x=this._desiredPositionDelta.y=0,this._cameraStyle==e.lockOn){var i=this._targetEntity.transform.position.x,n=this._targetEntity.transform.position.y;this._worldSpaceDeadZone.x>i?this._desiredPositionDelta.x=i-this._worldSpaceDeadZone.x:this._worldSpaceDeadZone.x<i&&(this._desiredPositionDelta.x=i-this._worldSpaceDeadZone.x),this._worldSpaceDeadZone.y<n?this._desiredPositionDelta.y=n-this._worldSpaceDeadZone.y:this._worldSpaceDeadZone.y>n&&(this._desiredPositionDelta.y=n-this._worldSpaceDeadZone.y)}else{if(!this._targetCollider&&(this._targetCollider=this._targetEntity.getComponent(t.Collider),!this._targetCollider))return;var r=this._targetEntity.getComponent(t.Collider).bounds;this._worldSpaceDeadZone.containsRect(r)||(this._worldSpaceDeadZone.left>r.left?this._desiredPositionDelta.x=r.left-this._worldSpaceDeadZone.left:this._worldSpaceDeadZone.right<r.right&&(this._desiredPositionDelta.x=r.right-this._worldSpaceDeadZone.right),this._worldSpaceDeadZone.bottom<r.bottom?this._desiredPositionDelta.y=r.bottom-this._worldSpaceDeadZone.bottom:this._worldSpaceDeadZone.top>r.top&&(this._desiredPositionDelta.y=r.top-this._worldSpaceDeadZone.top))}},n.prototype.setCenteredDeadzone=function(e,i){if(this.camera){var n=this.camera.bounds;this.deadzone=new t.Rectangle((n.width-e)/2,(n.height-i)/2,e,i)}else console.error("相机是null。我们不能得到它的边界。请等到该组件添加到实体之后")},n}(t.Component);t.FollowCamera=i}(es||(es={})),function(t){var e=function(e){function i(i){void 0===i&&(i=null);var n=e.call(this)||this;return i instanceof t.Sprite?n.setSprite(i):i instanceof egret.Texture&&n.setSprite(new t.Sprite(i)),n}return __extends(i,e),Object.defineProperty(i.prototype,"origin",{get:function(){return this._origin},set:function(t){this.setOrigin(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sprite",{get:function(){return this._sprite},set:function(t){this.setSprite(t)},enumerable:!0,configurable:!0}),i.prototype.setSprite=function(t){return this._sprite=t,this._sprite&&(this._origin=this._sprite.origin),this},i.prototype.setOrigin=function(t){return this._origin.equals(t)||(this._origin=t),this},i}(t.Component);t.SpriteRenderer=e}(es||(es={})),function(t){var e,i;!function(t){t[t.loop=0]="loop",t[t.once=1]="once",t[t.clampForever=2]="clampForever",t[t.pingPong=3]="pingPong",t[t.pingPongOnce=4]="pingPongOnce"}(e=t.LoopMode||(t.LoopMode={})),function(t){t[t.none=0]="none",t[t.running=1]="running",t[t.paused=2]="paused",t[t.completed=3]="completed"}(i=t.State||(t.State={}));var n=function(n){function r(t){var e=n.call(this,t)||this;return e.speed=1,e.animationState=i.none,e._elapsedTime=0,e._animations=new Map,e}return __extends(r,n),Object.defineProperty(r.prototype,"isRunning",{get:function(){return this.animationState==i.running},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animations",{get:function(){return this._animations},enumerable:!0,configurable:!0}),r.prototype.update=function(){if(this.animationState==i.running&&null!=this.currentAnimation){var n=this.currentAnimation,r=1/(n.frameRate*this.speed),o=r*n.sprites.length,s=n.sprites.length<3?o:r*(2*n.sprites.length-2);this._elapsedTime+=t.Time.deltaTime;var a=Math.abs(this._elapsedTime);if(this._loopMode==e.once&&a>o||this._loopMode==e.pingPongOnce&&a>s)return this.animationState=i.completed,this._elapsedTime=0,this.currentFrame=0,this.sprite=n.sprites[0],void this.onAnimationCompletedEvent(this.currentAnimationName);if(this._loopMode==e.clampForever&&a>o)return this.animationState=i.completed,this.currentFrame=n.sprites.length-1,this.sprite=n.sprites[this.currentFrame],void this.onAnimationCompletedEvent(this.currentAnimationName);var c=Math.floor(a/r),h=n.sprites.length;if(h>2&&(this._loopMode==e.pingPong||this._loopMode==e.pingPongOnce)){var u=h-1;this.currentFrame=u-Math.abs(u-c%(2*u))}else this.currentFrame=c%h;this.sprite=n.sprites[this.currentFrame]}},r.prototype.addAnimation=function(t,e){return!this.sprite&&e.sprites.length>0&&this.setSprite(e.sprites[0]),this._animations[t]=e,this},r.prototype.play=function(t,n){void 0===n&&(n=null),this.currentAnimation=this._animations[t],this.currentAnimationName=t,this.currentFrame=0,this.animationState=i.running,this.sprite=this.currentAnimation.sprites[0],this._elapsedTime=0,this._loopMode=n||e.loop},r.prototype.isAnimationActive=function(t){return null!=this.currentAnimation&&this.currentAnimationName==t},r.prototype.pause=function(){this.animationState=i.paused},r.prototype.unPause=function(){this.animationState=i.running},r.prototype.stop=function(){this.currentAnimation=null,this.currentAnimationName=null,this.currentFrame=0,this.animationState=i.none},r}(t.SpriteRenderer);t.SpriteAnimator=n}(es||(es={})),function(t){var e=function(){function e(){var i=egret.web.WebGLRenderContext.getInstance();e.gl=i.context,this.batcher=new t.Batcher(t.Core.graphicsDevice);var n=new egret.Texture;this.pixelTexture=new t.Sprite(n,new t.Rectangle(0,0,1,1))}return e.prototype.unload=function(){this.batcher.disposed(),this.batcher=null},e}();t.Graphics=e}(es||(es={})),function(t){var e=function(){function e(t,e){this._resources=new WeakSet,this.setup(t,e)}return e.prototype.setup=function(e,i){this._viewport=new t.Viewport(0,0,e,i),this._viewport.maxDepth=1,this.effectCache=new Map},e.prototype.dispose=function(t){this._isDisposed||(t&&this.effectCache.clear(),this._isDisposed=!0)},Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(t){this._viewport=t},enumerable:!0,configurable:!0}),e.prototype.addResourceReference=function(t){this._resources.add(t)},e.prototype.removeResourceReference=function(t){this._resources.delete(t)},e.getTitleSafeArea=function(t,e,i,n){return this.platformGetTitleSafeArea(t,e,i,n)},e.platformGetTitleSafeArea=function(e,i,n,r){return new t.Rectangle(e,i,n,r)},e}();t.GraphicsDevice=e}(es||(es={})),function(t){var e=function(){function t(t){this.effect=t}return t.prototype.dispose=function(){null!=this.effect&&(this.effect=null)},t.prototype.onPreRender=function(t){},t.prototype.compareTo=function(t){return null==t?1:this==t?0:-1},t.prototype.clone=function(){return new t(this.effect)},t.defaultMaterial=new t(null),t}();t.Material=e}(es||(es={})),function(t){var e=function(){function e(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.minDepth=0,this.maxDepth=1}return Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return 0!=this.height&&0!=this.width?this.width/this.height:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bounds",{get:function(){return new t.Rectangle(this.x,this.y,this.width,this.height)},set:function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"titleSafeArea",{get:function(){return t.GraphicsDevice.getTitleSafeArea(this.x,this.y,this.width,this.height)},enumerable:!0,configurable:!0}),e}();t.Viewport=e}(es||(es={})),function(t){var e=function(){function e(){this._selfReference=new WeakSet}return Object.defineProperty(e.prototype,"graphicsDevice",{get:function(){return this._graphicsDevice},set:function(e){t.Insist.isTrue(null!=e),this._graphicsDevice!=e&&(null!=this._graphicsDevice&&(this.updateResourceReference(!1),this._selfReference.delete(this)),this._graphicsDevice=e,this._selfReference.add(this),this.updateResourceReference(!0))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(t){this.isDisposed||(null!=this.graphicsDevice&&this.updateResourceReference(!1),this._selfReference.delete(this),this._graphicsDevice=null,this.isDisposed=!0)},e.prototype.updateResourceReference=function(t){t?this.graphicsDevice.addResourceReference(this._selfReference):this.graphicsDevice.removeResourceReference(this._selfReference)},e}();t.GraphicsResource=e}(es||(es={})),function(t){var e=function(e){function i(i){var n=e.call(this)||this;return n.shouldRoundDestinations=!0,n.MAX_SPRITES=2048,t.Insist.isTrue(null!=i),n.graphicsDevice=i,n._textureInfo=new Array(n.MAX_SPRITES),n._spriteEffect=new t.SpriteEffect,n._projectionMatrix=new t.Matrix,n._projectionMatrix.m11=0,n._projectionMatrix.m12=0,n._projectionMatrix.m13=0,n._projectionMatrix.m14=0,n._projectionMatrix.m21=0,n._projectionMatrix.m22=0,n._projectionMatrix.m23=0,n._projectionMatrix.m24=0,n._projectionMatrix.m31=0,n._projectionMatrix.m32=0,n._projectionMatrix.m33=1,n._projectionMatrix.m34=0,n._projectionMatrix.m41=-1,n._projectionMatrix.m42=1,n._projectionMatrix.m43=0,n._projectionMatrix.m44=1,n}return __extends(i,e),Object.defineProperty(i.prototype,"transformMatrix",{get:function(){return this._transformMatrix},enumerable:!0,configurable:!0}),i.prototype.disposed=function(){this.dispose(!0)},i.prototype.dispose=function(t){!this.isDisposed&&t&&(this._spriteEffect=null),e.prototype.dispose.call(this,t)},i.prototype.begin=function(e,i,n){void 0===n&&(n=!1),t.Insist.isFalse(this._beginCalled,"在最后一次调用Begin后，在调用End之前已经调用了Begin。在End被成功调用之前，不能再调用Begin"),this._beginCalled=!0,this._customEffect=e,this._transformMatrix=i,this._disableBatching=n,this._disableBatching&&this.prepRenderState()},i.prototype.end=function(){t.Insist.isTrue(this._beginCalled,"End已经被调用，但Begin还没有被调用。在调用End之前，必须先成功调用Begin"),this._beginCalled=!1,this._disableBatching||this.flushBatch(),this._customEffect=null},i.prototype.prepRenderState=function(){var e=this.graphicsDevice.viewport;this._projectionMatrix.m11=2/e.width,this._projectionMatrix.m22=-2/e.height,this._projectionMatrix.m41=-1-.5*this._projectionMatrix.m11,this._projectionMatrix.m42=1-.5*this._projectionMatrix.m22,t.Matrix.multiply(this._transformMatrix,this._projectionMatrix,this._matrixTransformMatrix),this._spriteEffect.setMatrixTransform(this._matrixTransformMatrix)},i.prototype.setIgnoreRoundingDestinations=function(t){this._shouldIgnoreRoundingDestinations=t},i.prototype.drawHollowRect=function(t,e,i){void 0===i&&(i=1),this.drawHollowBounds(t.x,t.y,t.width,t.height,e,i)},i.prototype.drawHollowBounds=function(e,i,n,r,o,s){void 0===s&&(s=1);var a=t.Vector2Ext.round(new t.Vector2(e,i)),c=t.Vector2Ext.round(new t.Vector2(e+n,i)),h=t.Vector2Ext.round(new t.Vector2(e+n,i+r)),u=t.Vector2Ext.round(new t.Vector2(e,i+r));this.setIgnoreRoundingDestinations(!0),this.drawLine(a,c,o,s),this.drawLine(c,h,o,s),this.drawLine(h,u,o,s),this.drawLine(u,a,o,s),this.setIgnoreRoundingDestinations(!1)},i.prototype.drawLine=function(e,i,n,r){this.drawLineAngle(e,t.MathHelper.angleBetweenVectors(e,i),t.Vector2.distance(e,i),n,r)},i.prototype.drawLineAngle=function(t,e,i,n,r){},i.prototype.drawPixel=function(e,i,n){void 0===n&&(n=1);var r=new t.Rectangle(e.x,e.y,n,n);1!=n&&(r.x-=.5*n,r.y-=.5*n)},i.prototype.drawPolygon=function(e,i,n,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=1),!(i.length<2)){this.setIgnoreRoundingDestinations(!0);for(var s=1;s<i.length;s++)this.drawLine(t.Vector2.add(e,i[s-1]),t.Vector2.add(e,i[s]),n,o);r&&this.drawLine(t.Vector2.add(e,i[i.length-1]),t.Vector2.add(e,i[0]),n,o),this.setIgnoreRoundingDestinations(!1)}},i.prototype.drawCircle=function(e,i,n,r,o){void 0===r&&(r=1),void 0===o&&(o=12);var s=t.Vector2.unitX.multiply(new t.Vector2(i)),a=t.Vector2Ext.perpendicularFlip(s);this.setIgnoreRoundingDestinations(!0);for(var c=1;c<=o;c++){var h=t.MathHelper.angleToVector(c*t.MathHelper.PiOver2/o,i),u=t.Vector2Ext.perpendicularFlip(h);this.drawLine(t.Vector2.add(e,s),t.Vector2.add(e,h),n,r),this.drawLine(t.Vector2.subtract(e,s),t.Vector2.subtract(e,h),n,r),this.drawLine(t.Vector2.add(e,a),t.Vector2.add(e,u),n,r),this.drawLine(t.Vector2.subtract(e,a),t.Vector2.subtract(e,u),n,r),s=h,a=u}this.setIgnoreRoundingDestinations(!1)},i.prototype.draw=function(e,i){this.checkBegin(),this.pushSprite(e,null,i.x,i.y,1,1,16777215,t.Vector2.zero,0,0,0,!1,0,0,0,0)},i.prototype.checkBegin=function(){if(!this._beginCalled)throw new Error("Begin还没有被叫到。在你画画之前，必须先调用Begin")},i.prototype.pushSprite=function(e,n,r,o,s,a,c,h,u,p,l,d,f,m,_,g){var y,x,v,b;if(void 0===n&&(n=null),this._numSprites>=this.MAX_SPRITES&&this.flushBatch(),!this._shouldIgnoreRoundingDestinations&&this.shouldRoundDestinations&&(r=Math.round(r),o=Math.round(o)),n){var w=1/e.width,M=1/e.height;n.x*w,n.y*M,y=n.width*w,x=n.height*M,v=h.x/y*w,b=h.y/x*M,d||(s*=n.width,a*=n.height)}else 0,0,y=1,x=1,v=h.x*(1/e.width),b=h.y*(1/e.height),d||(s*=e.width,a*=e.height);if(t.MathHelper.withinEpsilon(u))1,0,0,1;else{var S=Math.sin(u),D=Math.cos(u);D,S,-S,D}0!=l&&(f*=-1,-1,_*=-1);i._cornerOffsetX[0],i._cornerOffsetY[0];this._disableBatching?this.drawPrimitives(e,0,1):(this._textureInfo[this._numSprites]=e,this._numSprites+=1)},i.prototype.flushBatch=function(){if(0!=this._numSprites){var t=0,e=null;this.prepRenderState(),e=this._textureInfo[0];for(var i=1;i<this._numSprites;i+=1)this._textureInfo[i]!=e&&(this.drawPrimitives(e,t,i-t),e=this._textureInfo[i],t=i);this.drawPrimitives(e,t,this._numSprites-t),this._numSprites=0}},i.prototype.drawPrimitives=function(t,e,i){egret.sys.customHitTestBuffer;this._customEffect},i._cornerOffsetX=[0,1,0,1],i._cornerOffsetY=[0,0,1,1],i}(t.GraphicsResource);t.Batcher=e}(es||(es={})),function(t){var e=function(t){function e(){return t.call(this,e.defaultVert,e.primitive_frag)||this}return __extends(e,t),e.prototype.setMatrixTransform=function(t){this.uniforms.MatrixTransform=t},e.defaultVert="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\nattribute vec4 aColor;\r\n\r\nuniform vec2 projectionVector;\r\n// uniform vec2 offsetVector;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\n\r\nconst vec2 center = vec2(-1.0, 1.0);\r\n\r\nvoid main(void) {\r\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\r\n   vTextureCoord = aTextureCoord;\r\n   vColor = aColor;\r\n}",e.primitive_frag="precision lowp float;\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\n\r\nvoid main(void) {\r\n    gl_FragColor = vColor;\r\n}",e}(egret.CustomFilter);t.SpriteEffect=e}(es||(es={})),function(t){var e=function(){function e(e,i){void 0===i&&(i=null),this.material=t.Material.defaultMaterial,this.renderOrder=0,this.shouldDebugRender=!0,this.camera=i,this.renderOrder=e}return Object.defineProperty(e.prototype,"wantsToRenderToSceneRenderTarget",{get:function(){return null==this.renderTexture},enumerable:!0,configurable:!0}),e.prototype.onAddedToScene=function(t){},e.prototype.unload=function(){this.renderTexture&&this.renderTexture.dispose()},e.prototype.beginRender=function(e){this.renderTexture,this._currentMaterial=this.material,t.Graphics.instance.batcher.begin(this._currentMaterial.effect,t.Matrix2D.toMatrix(e.transformMatrix))},e.prototype.renderAfterStateCheck=function(e,i){null!=e.material&&e.material!=this._currentMaterial?(this._currentMaterial=e.material,null!=this._currentMaterial.effect&&this._currentMaterial.onPreRender(i),this.flushBatch(i)):null==e.material&&this._currentMaterial!=this.material&&(this._currentMaterial=this.material,this.flushBatch(i)),e.render(t.Graphics.instance.batcher,i)},e.prototype.flushBatch=function(e){t.Graphics.instance.batcher.end(),t.Graphics.instance.batcher.begin(this._currentMaterial.effect,t.Matrix2D.toMatrix(e.transformMatrix))},e.prototype.endRender=function(){t.Graphics.instance.batcher.end()},e.prototype.debugRender=function(e,i){t.Graphics.instance.batcher.end(),t.Graphics.instance.batcher.begin(null,t.Matrix2D.toMatrix(i.transformMatrix));for(var n=0,r=e.entities.buffer;n<r.length;n++){var o=r[n];o.enabled&&o.debugRender(t.Graphics.instance.batcher)}},e.prototype.onSceneBackBufferSizeChanged=function(t,e){},e.prototype.compare=function(t){return this.renderOrder-t.renderOrder},e}();t.Renderer=e}(es||(es={})),function(t){var e=function(e){function i(t,i){return void 0===t&&(t=0),void 0===i&&(i=null),e.call(this,t,i)||this}return __extends(i,e),i.prototype.render=function(e){var i=this.camera||e.camera;this.beginRender(i);for(var n=0;n<e.renderableComponents.count;n++){var r=e.renderableComponents.get(n);r.enabled&&r.isVisibleFromCamera(i)&&this.renderAfterStateCheck(r,i)}this.shouldDebugRender&&t.Core.debugRenderEndabled&&this.debugRender(e,i),this.endRender()},i}(t.Renderer);t.DefaultRenderer=e}(es||(es={})),function(t){var e=function(){function e(e,i,n){void 0===i&&(i=new t.Rectangle(0,0,e.textureWidth,e.textureHeight)),void 0===n&&(n=i.getHalfSize()),this.uvs=new t.Rectangle,this.texture2D=e,this.sourceRect=i,this.center=new t.Vector2(.5*i.width,.5*i.height),this.origin=n;var r=1/e.textureWidth,o=1/e.textureHeight;this.uvs.x=i.x*r,this.uvs.y=i.y*o,this.uvs.width=i.width*r,this.uvs.height=i.height*o}return e.prototype.clone=function(){return new e(this.texture2D,this.sourceRect,this.origin)},e.spritesFromAtlas=function(t,i,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Number.MAX_VALUE);for(var s=[],a=t.textureWidth/i,c=t.textureHeight/n,h=0,u=new egret.SpriteSheet(t),p=0;p<c;p++)for(var l=0;l<a;l++)if(!(h++<r)){var d=u.getTexture(p+"_"+l);if(d||(d=u.createTexture(p+"_"+l,l*i,p*n,i,n)),s.push(new e(d)),s.length==o)return s}return s},e}();t.Sprite=e}(es||(es={})),function(t){var e=function(){function e(t){void 0===t&&(t=null),this.sceneLoadAction=t,this._loadsNewScene=null!=t}return Object.defineProperty(e.prototype,"hasPreviousSceneRender",{get:function(){return!!this._hasPreviousSceneRender||(this._hasPreviousSceneRender=!0,!1)},enumerable:!0,configurable:!0}),e.prototype.loadNextScene=function(){var e=this;return __generator(this,function(i){switch(i.label){case 0:return this.onScreenObscured&&this.onScreenObscured(),this._loadsNewScene?[3,2]:(this._isNewSceneLoaded=!0,[4,"break"]);case 1:i.sent(),i.label=2;case 2:this.loadSceneOnBackgroundThread?Promise.resolve(function(){var i=e.sceneLoadAction();t.Core.schedule(0,!1,null,function(n){t.Core.scene=i,e._isNewSceneLoaded=!0})}):(t.Core.scene=this.sceneLoadAction(),this._isNewSceneLoaded=!0),i.label=3;case 3:return this._isNewSceneLoaded?[3,5]:[4,null];case 4:return i.sent(),[3,3];case 5:return[2]}})},e.prototype.onBeginTransition=function(){return __generator(this,function(e){switch(e.label){case 0:return[4,null];case 1:return e.sent(),[4,t.Core.startCoroutine(this.loadNextScene())];case 2:return e.sent(),this.transitionComplete(),[2]}})},e.prototype.preRener=function(t){},e.prototype.render=function(e){e.begin(null,t.Matrix2D.toMatrix(t.Matrix2D.identity),!1),e.draw(this.previousSceneRender,t.Vector2.zero),e.end()},e.prototype.transitionComplete=function(){t.Core._instance._sceneTransition=null,null!=this.previousSceneRender&&(this.previousSceneRender.texture.dispose(),this.previousSceneRender=null),this.onTransitionCompleted&&this.onTransitionCompleted()},e.prototype.tickEffectProgressProperty=function(e,i,n,r){var o;return void 0===r&&(r=!1),__generator(this,function(n){switch(n.label){case 0:r?1:0,r?0:1,o=0,n.label=1;case 1:return o<i?(o+=t.Time.deltaTime,0,e.uniforms._progress=0,[4,null]):[3,3];case 2:return n.sent(),[3,1];case 3:return[2]}})},e}();t.SceneTransition=e}(es||(es={}));