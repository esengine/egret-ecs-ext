window.es={},window.__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();var __awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(s,a)}c((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};!function(e){var t=function(t){function i(){var n=t.call(this)||this;return n._globalManagers=[],n._coroutineManager=new e.CoroutineManager,n._timerManager=new e.TimerManager,n._frameCounterElapsedTime=0,n._frameCounter=0,n._totalMemory=0,i._instance=n,i.emitter=e.Framework.emitter,i.registerGlobalManager(n._coroutineManager),i.registerGlobalManager(n._timerManager),n.addEventListener(egret.Event.ENTER_FRAME,n.update,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.initialize,n),n}return __extends(i,t),Object.defineProperty(i,"Instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(i,"scene",{get:function(){return this._instance?this._instance._scene:null},set:function(e){e?null==this._instance._scene?(this._instance._scene=e,this._instance.onSceneChanged(),this._instance._scene.begin()):this._instance._nextScene=e:console.error("场景不能为空")},enumerable:!0,configurable:!0}),i.registerGlobalManager=function(e){this._instance._globalManagers.push(e),e.enabled=!0},i.unregisterGlobalManager=function(e){new linq.List(this._instance._globalManagers).remove(e),e.enabled=!1},i.getGlobalManager=function(e){for(var t=0;t<this._instance._globalManagers.length;t++)if(this._instance._globalManagers[t]instanceof e)return this._instance._globalManagers[t];return null},i.startCoroutine=function(e){return this._instance._coroutineManager.startCoroutine(e)},i.schedule=function(e,t,i,n){return void 0===t&&(t=!1),void 0===i&&(i=null),this._instance._timerManager.schedule(e,t,i,n)},i.prototype.onOrientationChanged=function(){i.emitter.emit(e.CoreEvents.orientationChanged)},i.prototype.startDebugDraw=function(){if(this._frameCounter++,this._frameCounterElapsedTime+=e.Time.deltaTime,this._frameCounterElapsedTime>=1){var t=window.performance.memory;null!=t&&(this._totalMemory=Number((t.totalJSHeapSize/1048576).toFixed(2))),this._titleMemory&&this._titleMemory(this._totalMemory,this._frameCounter),this._frameCounter=0,this._frameCounterElapsedTime-=1}},i.prototype.onSceneChanged=function(){i.emitter.emit(e.CoreEvents.sceneChanged),e.Time.sceneChanged()},i.startSceneTransition=function(t){return e.Insist.isNull(this._instance._sceneTransition,"在上一个场景转换完成之前，您不能启动新的场景转换"),this._instance._sceneTransition=t,t},i.prototype.onGraphicsDeviceReset=function(){null!=this._graphicsDeviceChangeTimer?this._graphicsDeviceChangeTimer.reset():this._graphicsDeviceChangeTimer=i.schedule(.05,!1,this,function(t){t.context._graphicsDeviceChangeTimer=null,i.emitter.emit(e.CoreEvents.graphicsDeviceReset)})},i.prototype.initialize=function(){i.graphicsDevice=new e.GraphicsDevice(this.stage.stageWidth,this.stage.stageHeight),e.Graphics.instance=new e.Graphics,e.PlatformEvent.initialize()},i.prototype.update=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){if(e.Time.update(egret.getTimer()),null!=this._scene){for(t=this._globalManagers.length-1;t>=0;t--)this._globalManagers[t].enabled&&this._globalManagers[t].update();null!=this._sceneTransition&&(null==this._sceneTransition||this._sceneTransition._loadsNewScene&&!this._sceneTransition._isNewSceneLoaded)||this._scene.update(),null!=this._nextScene&&(this._scene.end(),this._scene=this._nextScene,this._nextScene=null,this.onSceneChanged(),this._scene.begin())}return this.draw(),[2]})})},i.prototype.draw=function(){this.startDebugDraw(),null!=this._sceneTransition&&this._sceneTransition.preRener(e.Graphics.instance.batcher),null!=this._sceneTransition?(null!=this._scene&&this._sceneTransition.wantsPreviousSceneRender&&!this._sceneTransition.hasPreviousSceneRender?(this._scene.render(),this._scene.postRender(this._sceneTransition.previousSceneRender),i.startCoroutine(this._sceneTransition.onBeginTransition())):null!=this._scene&&this._sceneTransition._isNewSceneLoaded&&(this._scene.render(),this._scene.postRender()),this._sceneTransition.render(e.Graphics.instance.batcher)):null!=this._scene&&(this._scene.render(),this._scene.postRender())},i.pauseOnFocusLost=!0,i.debugRenderEndabled=!1,i}(egret.DisplayObjectContainer);e.Core=t}(es||(es={})),function(e){var t=function(){function t(){}return t.initialize=function(){e.Screen.width=e.Core.Instance.stage.stageWidth,e.Screen.height=e.Core.Instance.stage.stageHeight,e.Core.emitter.addObserver(e.CoreEvents.addDefaultRender,this.addDefaultRenderer,this),e.Core.emitter.addObserver(e.CoreEvents.createRenderTarget,this.createRenderTarget,this),e.Core.emitter.addObserver(e.CoreEvents.disposeRenderTarget,this.disposeRenderTarget,this),e.Core.emitter.addObserver(e.CoreEvents.setRenderTarget,this.setRenderTarget,this),e.Core.emitter.addObserver(e.CoreEvents.resolutionOffset,this.setResolutionOffset,this),e.Core.emitter.addObserver(e.CoreEvents.resolutionScale,this.setResuolutionScale,this),e.Core.emitter.addObserver(e.CoreEvents.createCamera,this.createCamera,this),e.Framework.batcher=e.Graphics.instance.batcher},t.addDefaultRenderer=function(){e.Core.scene.addRenderer(new e.DefaultRenderer)},t.createRenderTarget=function(t,i,n){t.value=new egret.RenderTexture,t.value.drawToTexture(e.Core.Instance,new egret.Rectangle(0,0,i,n))},t.disposeRenderTarget=function(e){e&&e.value&&(e.value.dispose(),e.value=null)},t.setRenderTarget=function(t){t||(t=new e.Ref(null)),t.value=new egret.RenderTexture,t.value.drawToTexture(e.Core.Instance)},t.setResolutionOffset=function(e){},t.setResuolutionScale=function(e){},t.createCamera=function(t){var i=t.createEntity("camera");t.camera=i.addComponent(new e.Camera)},t}();e.PlatformEvent=t}(es||(es={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.load=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return t?RES.isGroupLoaded(t)?[3,2]:[4,RES.loadGroup(t,0,new i(n))]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,RES.getResAsync(e)];case 3:return[2,r.sent()]}})})},t}(e.GlobalManager);e.AssetManager=t;var i=function(){function e(e){this.assetUserTask=e}return e.prototype.onProgress=function(e,t,i){this.assetUserTask&&this.assetUserTask(e,t,i)},e}();e.AssetTaskReport=i}(es||(es={})),function(e){var t=function(){return function(e,t){void 0===t&&(t=10),this.sprites=e,this.frameRate=t}}();e.SpriteAnimation=t}(es||(es={})),function(e){var t=function(t){function i(){var i=t.call(this)||this;return i._inset={left:0,right:0,top:0,bottom:0},i._bounds=new e.Rectangle,i._transformMatrix=e.Matrix2D.identity,i._inverseTransformMatrix=e.Matrix2D.identity,i._origin=e.Vector2.zero,i._minimumZoom=.3,i._zoom=0,i._maximumZoom=3,i._areMatrixedDirty=!0,i._areBoundsDirty=!0,i._isProjectionMatrixDirty=!0,i.setZoom(0),i}return __extends(i,t),Object.defineProperty(i.prototype,"position",{get:function(){return this.entity.transform.position},set:function(e){this.entity.transform.position=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this.entity.transform.rotation},set:function(e){this.entity.transform.rotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawZoom",{get:function(){return this._zoom},set:function(e){e!=this._zoom&&(this._zoom=e,this._areMatrixedDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zoom",{get:function(){return 0==this._zoom?1:this._zoom<1?e.MathHelper.map(this._zoom,this._minimumZoom,1,-1,0):e.MathHelper.map(this._zoom,1,this._maximumZoom,0,1)},set:function(e){this.setZoom(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minimumZoom",{get:function(){return this._minimumZoom},set:function(e){this.setMinimumZoom(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maximumZoom",{get:function(){return this._maximumZoom},set:function(e){this.setMaximumZoom(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bounds",{get:function(){if(this._areMatrixedDirty&&this.updateMatrixes(),this._areBoundsDirty){var t=this.screenToWorldPoint(new e.Vector2(this._inset.left,this._inset.top)),i=this.screenToWorldPoint(new e.Vector2(e.Core.Instance.width-this._inset.right,e.Core.Instance.height-this._inset.bottom));if(0!=this.entity.transform.rotation){var n=this.screenToWorldPoint(new e.Vector2(e.Core.Instance.width-this._inset.right,this._inset.top)),r=this.screenToWorldPoint(new e.Vector2(this._inset.left,e.Core.Instance.height-this._inset.bottom)),o=Math.min(t.x,i.x,n.x,r.x),s=Math.max(t.x,i.x,n.x,r.x),a=Math.min(t.y,i.y,n.y,r.y),c=Math.max(t.y,i.y,n.y,r.y);this._bounds.location=new e.Vector2(o,a),this._bounds.width=s-o,this._bounds.height=c-a}else this._bounds.location=t,this._bounds.width=i.x-t.x,this._bounds.height=i.y-t.y;this._areBoundsDirty=!1}return this._bounds},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transformMatrix",{get:function(){return this._areMatrixedDirty&&this.updateMatrixes(),this._transformMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inverseTransformMatrix",{get:function(){return this._areMatrixedDirty&&this.updateMatrixes(),this._inverseTransformMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"projectionMatrix",{get:function(){return this._isProjectionMatrixDirty&&(e.Matrix.createOrthographicOffCenter(0,e.Core.graphicsDevice.viewport.width,e.Core.graphicsDevice.viewport.height,0,0,-1,this._projectionMatrix),this._isProjectionMatrixDirty=!1),this._projectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewprojectionMatrix",{get:function(){return e.Matrix.multiply(e.Matrix2D.toMatrix(this.transformMatrix),this.projectionMatrix),this.projectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"origin",{get:function(){return this._origin},set:function(e){this._origin!=e&&(this._origin=e,this._areMatrixedDirty=!0)},enumerable:!0,configurable:!0}),i.prototype.setInset=function(e,t,i,n){return this._inset={left:e,right:t,top:i,bottom:n},this._areBoundsDirty=!0,this},i.prototype.setPosition=function(e){return this.entity.transform.setPosition(e.x,e.y),this},i.prototype.setRotation=function(e){return this.entity.transform.setRotation(e),this},i.prototype.setZoom=function(t){var i=e.MathHelper.clamp(t,-1,1);return this._zoom=0==i?1:i<0?e.MathHelper.map(i,-1,0,this._minimumZoom,1):e.MathHelper.map(i,0,1,1,this._maximumZoom),this._areMatrixedDirty=!0,this},i.prototype.setMinimumZoom=function(t){return e.Insist.isTrue(t>0,"minimumZoom必须大于零"),this._zoom<t&&(this._zoom=this.minimumZoom),this._minimumZoom=t,this},i.prototype.setMaximumZoom=function(t){return e.Insist.isTrue(t>0,"MaximumZoom必须大于零"),this._zoom>t&&(this._zoom=t),this._maximumZoom=t,this},i.prototype.forceMatrixUpdate=function(){this._areMatrixedDirty=!0},i.prototype.onEntityTransformChanged=function(e){this._areMatrixedDirty=!0},i.prototype.zoomIn=function(e){this.zoom+=e},i.prototype.zoomOut=function(e){this.zoom-=e},i.prototype.worldToScreenPoint=function(t){return this.updateMatrixes(),e.Vector2Ext.transformR(t,this._transformMatrix,t),t},i.prototype.screenToWorldPoint=function(t){return this.updateMatrixes(),e.Vector2Ext.transformR(t,this._inverseTransformMatrix,t),t},i.prototype.onSceneRenderTargetSizeChanged=function(t,i){this._isProjectionMatrixDirty=!0;var n=this._origin.clone();this.origin=new e.Vector2(t/2,i/2),this.entity.position=e.Vector2.add(this.entity.position,e.Vector2.subtract(this._origin,n))},i.prototype.updateMatrixes=function(){var t;this._areMatrixedDirty&&(this._transformMatrix=e.Matrix2D.createTranslation(-this.entity.transform.position.x,-this.entity.transform.position.y),1!=this._zoom&&(t=e.Matrix2D.createScale(this._zoom,this._zoom),this._transformMatrix=this._transformMatrix.multiply(t)),0!=this.entity.transform.rotation&&(t=e.Matrix2D.createRotation(this.entity.transform.rotation),this._transformMatrix=this._transformMatrix.multiply(t)),t=e.Matrix2D.createTranslation(this._origin.x,this._origin.y),this._transformMatrix=this._transformMatrix.multiply(t),this._inverseTransformMatrix=e.Matrix2D.invert(this._transformMatrix),this._areBoundsDirty=!0,this._areMatrixedDirty=!1)},i}(e.Component);e.Camera=t}(es||(es={})),function(e){var t=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i._shakeDirection=e.Vector2.zero,i._shakeOffset=e.Vector2.zero,i._shakeIntensity=0,i._shakeDegredation=.95,i}return __extends(i,t),i.prototype.shake=function(t,i,n){void 0===t&&(t=15),void 0===i&&(i=.9),void 0===n&&(n=e.Vector2.zero),this.enabled=!0,this._shakeIntensity<t&&(this._shakeDirection=n,this._shakeIntensity=t,(i<0||i>=1)&&(i=.95),this._shakeDegredation=i)},i.prototype.update=function(){Math.abs(this._shakeIntensity)>0&&(this._shakeOffset=this._shakeDirection,0!=this._shakeOffset.x||0!=this._shakeOffset.y?this._shakeOffset.normalize():(this._shakeOffset.x=this._shakeOffset.x+Math.random()-.5,this._shakeOffset.y=this._shakeOffset.y+Math.random()-.5),this._shakeOffset.multiply(new e.Vector2(this._shakeIntensity)),this._shakeIntensity*=-this._shakeDegredation,Math.abs(this._shakeIntensity)<=.01&&(this._shakeIntensity=0,this.enabled=!1))},i}(e.Component);e.CameraShake=t}(es||(es={})),function(e){var t;!function(e){e[e.lockOn=0]="lockOn",e[e.cameraWindow=1]="cameraWindow"}(t=e.CameraStyle||(e.CameraStyle={}));var i=function(i){function n(n,r,o){void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=t.lockOn);var s=i.call(this)||this;return s.followLerp=.1,s.deadzone=new e.Rectangle,s.focusOffset=e.Vector2.zero,s.mapLockEnabled=!1,s.mapSize=new e.Rectangle,s._desiredPositionDelta=new e.Vector2,s._worldSpaceDeadZone=new e.Rectangle,s._targetEntity=n,s._cameraStyle=o,s.camera=r,s}return __extends(n,i),n.prototype.onAddedToEntity=function(){null==this.camera&&(this.camera=this.entity.getOrCreateComponent(e.Camera)),this.follow(this._targetEntity,this._cameraStyle),e.Core.emitter.addObserver(e.CoreEvents.graphicsDeviceReset,this.onGraphicsDeviceReset,this)},n.prototype.onGraphicsDeviceReset=function(){e.Core.schedule(0,!1,this,function(e){var t=e.context;t.follow(t._targetEntity,t._cameraStyle)})},n.prototype.update=function(){var t=e.Vector2.multiply(this.camera.bounds.size,new e.Vector2(.5));this._worldSpaceDeadZone.x=this.camera.position.x-t.x+this.deadzone.x+this.focusOffset.x,this._worldSpaceDeadZone.y=this.camera.position.y-t.y+this.deadzone.y+this.focusOffset.y,this._worldSpaceDeadZone.width=this.deadzone.width,this._worldSpaceDeadZone.height=this.deadzone.height,this._targetEntity&&this.updateFollow(),this.camera.position=e.Vector2.lerp(this.camera.position,e.Vector2.add(this.camera.position,this._desiredPositionDelta),this.followLerp),this.entity.transform.roundPosition(),this.mapLockEnabled&&(this.camera.position=this.clampToMapSize(this.camera.position),this.entity.transform.roundPosition())},n.prototype.clampToMapSize=function(t){var i=e.Vector2.multiply(this.camera.bounds.size,new e.Vector2(.5)).add(new e.Vector2(this.mapSize.x,this.mapSize.y)),n=new e.Vector2(this.mapSize.width-i.x,this.mapSize.height-i.y);return e.Vector2.clamp(t,i,n)},n.prototype.follow=function(i,n){void 0===n&&(n=t.cameraWindow),this._targetEntity=i,this._cameraStyle=n;var r=this.camera.bounds;switch(this._cameraStyle){case t.cameraWindow:var o=r.width/6,s=r.height/3;this.deadzone=new e.Rectangle((r.width-o)/2,(r.height-s)/2,o,s);break;case t.lockOn:this.deadzone=new e.Rectangle(r.width/2,r.height/2,10,10)}},n.prototype.updateFollow=function(){if(this._desiredPositionDelta.x=this._desiredPositionDelta.y=0,this._cameraStyle==t.lockOn){var i=this._targetEntity.transform.position.x,n=this._targetEntity.transform.position.y;this._worldSpaceDeadZone.x>i?this._desiredPositionDelta.x=i-this._worldSpaceDeadZone.x:this._worldSpaceDeadZone.x<i&&(this._desiredPositionDelta.x=i-this._worldSpaceDeadZone.x),this._worldSpaceDeadZone.y<n?this._desiredPositionDelta.y=n-this._worldSpaceDeadZone.y:this._worldSpaceDeadZone.y>n&&(this._desiredPositionDelta.y=n-this._worldSpaceDeadZone.y)}else{if(!this._targetCollider&&(this._targetCollider=this._targetEntity.getComponent(e.Collider),!this._targetCollider))return;var r=this._targetEntity.getComponent(e.Collider).bounds;this._worldSpaceDeadZone.containsRect(r)||(this._worldSpaceDeadZone.left>r.left?this._desiredPositionDelta.x=r.left-this._worldSpaceDeadZone.left:this._worldSpaceDeadZone.right<r.right&&(this._desiredPositionDelta.x=r.right-this._worldSpaceDeadZone.right),this._worldSpaceDeadZone.bottom<r.bottom?this._desiredPositionDelta.y=r.bottom-this._worldSpaceDeadZone.bottom:this._worldSpaceDeadZone.top>r.top&&(this._desiredPositionDelta.y=r.top-this._worldSpaceDeadZone.top))}},n.prototype.setCenteredDeadzone=function(t,i){if(this.camera){var n=this.camera.bounds;this.deadzone=new e.Rectangle((n.width-t)/2,(n.height-i)/2,t,i)}else console.error("相机是null。我们不能得到它的边界。请等到该组件添加到实体之后")},n}(e.Component);e.FollowCamera=i}(es||(es={})),function(e){var t=function(t){function i(i){void 0===i&&(i=null);var n=t.call(this)||this;return n.spriteEffects=e.SpriteEffects.none,i instanceof e.Sprite?n.setSprite(i):i instanceof egret.Texture&&n.setSprite(new e.Sprite(i)),n}return __extends(i,t),Object.defineProperty(i.prototype,"bounds",{get:function(){return this._areBoundsDirty&&(null!=this._sprite&&this._bounds.calculateBounds(this.entity.transform.position,this._localOffset,this._origin,this.entity.transform.scale,this.entity.transform.rotation,this._sprite.sourceRect.width,this._sprite.sourceRect.height),this._areBoundsDirty=!1),this._bounds},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this.bounds.width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._bounds.height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"origin",{get:function(){return this._origin},set:function(e){this.setOrigin(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"originNormalized",{get:function(){return new e.Vector2(this._origin.x/this.width*this.entity.transform.scale.x,this._origin.y/this.height*this.entity.transform.scale.y)},set:function(t){this.setOrigin(new e.Vector2(t.x*this.width/this.entity.transform.scale.x,t.y*this.height/this.entity.transform.scale.y))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipY",{get:function(){return(this.spriteEffects&e.SpriteEffects.flipVertically)==e.SpriteEffects.flipHorizontally},set:function(t){this.spriteEffects=t?this.spriteEffects|e.SpriteEffects.flipVertically:this.spriteEffects&~e.SpriteEffects.flipVertically},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipX",{get:function(){return(this.spriteEffects&e.SpriteEffects.flipHorizontally)==e.SpriteEffects.flipHorizontally},set:function(t){this.spriteEffects=t?this.spriteEffects|e.SpriteEffects.flipHorizontally:this.spriteEffects&~e.SpriteEffects.flipHorizontally},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sprite",{get:function(){return this._sprite},set:function(e){this.setSprite(e)},enumerable:!0,configurable:!0}),i.prototype.setSprite=function(e){return this._sprite=e,this._sprite&&(this._origin=this._sprite.origin,this._areBoundsDirty=!0),this},i.prototype.setOrigin=function(e){return this._origin.equals(e)||(this._origin=e),this},i.prototype.setOriginNormalized=function(t){this.setOrigin(new e.Vector2(t.x*this.width/this.entity.transform.scale.x,t.y*this.height/this.entity.transform.scale.y))},i.prototype.drawOutline=function(t,i,n,r){void 0===n&&(n=0),void 0===r&&(r=1);var o=this._localOffset.clone(),s=this.color,a=this._layerDepth;this.color=n,this._layerDepth+=.01;for(var c=-1;c<2;c++)for(var h=-1;h<2;h++)0==c&&0==h||(this._localOffset=e.Vector2.add(o,new e.Vector2(c*r,h*r)),this.render(t,i));this._localOffset=o,this.color=s,this._layerDepth=a},i.prototype.render=function(t,i){t.draw(this.sprite.texture2D,e.Vector2.add(this.entity.transform.position,this.localOffset),this.color,this.entity.transform.rotation,this.origin,this.entity.transform.scale,this.spriteEffects,this._layerDepth)},i}(e.RenderableComponent);e.SpriteRenderer=t}(es||(es={})),function(e){var t,i;!function(e){e[e.loop=0]="loop",e[e.once=1]="once",e[e.clampForever=2]="clampForever",e[e.pingPong=3]="pingPong",e[e.pingPongOnce=4]="pingPongOnce"}(t=e.LoopMode||(e.LoopMode={})),function(e){e[e.none=0]="none",e[e.running=1]="running",e[e.paused=2]="paused",e[e.completed=3]="completed"}(i=e.State||(e.State={}));var n=function(n){function r(e){var t=n.call(this,e)||this;return t.speed=1,t.animationState=i.none,t._elapsedTime=0,t._animations=new Map,t}return __extends(r,n),Object.defineProperty(r.prototype,"isRunning",{get:function(){return this.animationState==i.running},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animations",{get:function(){return this._animations},enumerable:!0,configurable:!0}),r.prototype.update=function(){if(this.animationState==i.running&&null!=this.currentAnimation){var n=this.currentAnimation,r=1/(n.frameRate*this.speed),o=r*n.sprites.length,s=n.sprites.length<3?o:r*(2*n.sprites.length-2);this._elapsedTime+=e.Time.deltaTime;var a=Math.abs(this._elapsedTime);if(this._loopMode==t.once&&a>o||this._loopMode==t.pingPongOnce&&a>s)return this.animationState=i.completed,this._elapsedTime=0,this.currentFrame=0,this.sprite=n.sprites[0],void this.onAnimationCompletedEvent(this.currentAnimationName);if(this._loopMode==t.clampForever&&a>o)return this.animationState=i.completed,this.currentFrame=n.sprites.length-1,this.sprite=n.sprites[this.currentFrame],void this.onAnimationCompletedEvent(this.currentAnimationName);var c=Math.floor(a/r),h=n.sprites.length;if(h>2&&(this._loopMode==t.pingPong||this._loopMode==t.pingPongOnce)){var u=h-1;this.currentFrame=u-Math.abs(u-c%(2*u))}else this.currentFrame=c%h;this.sprite=n.sprites[this.currentFrame]}},r.prototype.addAnimation=function(e,t){return!this.sprite&&t.sprites.length>0&&this.setSprite(t.sprites[0]),this._animations[e]=t,this},r.prototype.play=function(e,n){void 0===n&&(n=null),this.currentAnimation=this._animations[e],this.currentAnimationName=e,this.currentFrame=0,this.animationState=i.running,this.sprite=this.currentAnimation.sprites[0],this._elapsedTime=0,this._loopMode=n||t.loop},r.prototype.isAnimationActive=function(e){return null!=this.currentAnimation&&this.currentAnimationName==e},r.prototype.pause=function(){this.animationState=i.paused},r.prototype.unPause=function(){this.animationState=i.running},r.prototype.stop=function(){this.currentAnimation=null,this.currentAnimationName=null,this.currentFrame=0,this.animationState=i.none},r}(e.SpriteRenderer);e.SpriteAnimator=n}(es||(es={})),function(e){var t=function(){function t(){var i=egret.web.WebGLRenderContext.getInstance();t.gl=i.context,this.batcher=new e.Batcher(e.Core.graphicsDevice);var n=new egret.Texture;this.pixelTexture=new e.Sprite(n,new e.Rectangle(0,0,1,1))}return t.prototype.unload=function(){this.batcher.disposed(),this.batcher=null},t}();e.Graphics=t}(es||(es={})),function(e){var t=function(){function t(e,t){this._resources=new WeakSet,this.setup(e,t)}return t.prototype.setup=function(t,i){this._viewport=new e.Viewport(0,0,t,i),this._viewport.maxDepth=1,this.effectCache=new Map},t.prototype.dispose=function(e){this._isDisposed||(e&&this.effectCache.clear(),this._isDisposed=!0)},Object.defineProperty(t.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this._viewport=e},enumerable:!0,configurable:!0}),t.prototype.addResourceReference=function(e){this._resources.add(e)},t.prototype.removeResourceReference=function(e){this._resources.delete(e)},t.getTitleSafeArea=function(e,t,i,n){return this.platformGetTitleSafeArea(e,t,i,n)},t.platformGetTitleSafeArea=function(t,i,n,r){return new e.Rectangle(t,i,n,r)},t}();e.GraphicsDevice=t}(es||(es={})),function(e){var t=function(){function e(e){this.effect=e}return e.prototype.dispose=function(){null!=this.effect&&(this.effect=null)},e.prototype.onPreRender=function(e){},e.prototype.compareTo=function(e){return null==e?1:this==e?0:-1},e.prototype.clone=function(){return new e(this.effect)},e.defaultMaterial=new e(null),e}();e.Material=t}(es||(es={})),function(e){!function(e){e[e.none=0]="none",e[e.flipHorizontally=1]="flipHorizontally",e[e.flipVertically=2]="flipVertically"}(e.SpriteEffects||(e.SpriteEffects={}))}(es||(es={})),function(e){var t=function(){function t(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n,this.minDepth=0,this.maxDepth=1}return Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return 0!=this.height&&0!=this.width?this.width/this.height:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bounds",{get:function(){return new e.Rectangle(this.x,this.y,this.width,this.height)},set:function(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"titleSafeArea",{get:function(){return e.GraphicsDevice.getTitleSafeArea(this.x,this.y,this.width,this.height)},enumerable:!0,configurable:!0}),t}();e.Viewport=t}(es||(es={})),function(e){var t=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._selfReference=new WeakSet,e}return __extends(i,t),Object.defineProperty(i.prototype,"graphicsDevice",{get:function(){return this._graphicsDevice},set:function(t){e.Insist.isTrue(null!=t),this._graphicsDevice!=t&&(null!=this._graphicsDevice&&(this.updateResourceReference(!1),this._selfReference.delete(this)),this._graphicsDevice=t,this._selfReference.add(this),this.updateResourceReference(!0))},enumerable:!0,configurable:!0}),i.prototype.dispose=function(e){this.isDisposed||(null!=this.graphicsDevice&&this.updateResourceReference(!1),this._selfReference.delete(this),this._graphicsDevice=null,this.isDisposed=!0)},i.prototype.updateResourceReference=function(e){e?this.graphicsDevice.addResourceReference(this._selfReference):this.graphicsDevice.removeResourceReference(this._selfReference)},i}(egret.DisplayObjectContainer);e.GraphicsResource=t}(es||(es={})),function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.shouldRoundDestinations=!0,n.MAX_SPRITES=2048,e.Insist.isTrue(null!=i),n.graphicsDevice=i,n._textureInfo=new Array(n.MAX_SPRITES),n._spriteEffect=new e.SpriteEffect,n._projectionMatrix=new e.Matrix,n._projectionMatrix.m11=0,n._projectionMatrix.m12=0,n._projectionMatrix.m13=0,n._projectionMatrix.m14=0,n._projectionMatrix.m21=0,n._projectionMatrix.m22=0,n._projectionMatrix.m23=0,n._projectionMatrix.m24=0,n._projectionMatrix.m31=0,n._projectionMatrix.m32=0,n._projectionMatrix.m33=1,n._projectionMatrix.m34=0,n._projectionMatrix.m41=-1,n._projectionMatrix.m42=1,n._projectionMatrix.m43=0,n._projectionMatrix.m44=1,e.Core.Instance.stage.addChild(n),n.idDisplayObjectDic=new Map,e.Pool.warmCache(egret.DisplayObject,3),e.Core.emitter.addObserver(e.CoreEvents.clearGraphics,n.clear,n),n}return __extends(i,t),Object.defineProperty(i.prototype,"transformMatrix",{get:function(){return this._transformMatrix},enumerable:!0,configurable:!0}),i.prototype.disposed=function(){this.dispose(!0)},i.prototype.dispose=function(i){var n=this;!this.isDisposed&&i&&(this._spriteEffect=null,this.idDisplayObjectDic.forEach(function(t,i){t.parent&&t.parent.removeChild(t),n.idDisplayObjectDic.delete(i),e.Pool.free(t)})),t.prototype.dispose.call(this,i)},i.prototype.clear=function(){this.idDisplayObjectDic.forEach(function(e){e instanceof egret.Shape?e.graphics.clear():e instanceof egret.Bitmap&&(e.texture=null)})},i.prototype.begin=function(t,i,n,r){void 0===n&&(n=e.Matrix2D.toMatrix(e.Matrix2D.identity)),void 0===r&&(r=!1),e.Insist.isFalse(this._beginCalled,"在最后一次调用Begin后，在调用End之前已经调用了Begin。在End被成功调用之前，不能再调用Begin"),this._id=t,this._beginCalled=!0,this._customEffect=i,this._transformMatrix=n,this._disableBatching=r,this._disableBatching&&this.prepRenderState(),null==t.value?(t.value=e.RenderableComponent.renderIdGenerator++,this._displayObject=e.Pool.obtain(egret.DisplayObject),this.idDisplayObjectDic.set(t.value,this._displayObject)):this._displayObject=this.idDisplayObjectDic.get(t.value)},i.prototype.end=function(){e.Insist.isTrue(this._beginCalled,"End已经被调用，但Begin还没有被调用。在调用End之前，必须先成功调用Begin"),this._beginCalled=!1,this._displayObject.cacheAsBitmap=this._disableBatching,null==this._displayObject.parent&&this.addChild(this._displayObject),this._customEffect=null},i.prototype.prepRenderState=function(){var t=this.graphicsDevice.viewport;this._projectionMatrix.m11=2/t.width,this._projectionMatrix.m22=-2/t.height,this._projectionMatrix.m41=-1-.5*this._projectionMatrix.m11,this._projectionMatrix.m42=1-.5*this._projectionMatrix.m22,e.Matrix.multiply(this._transformMatrix,this._projectionMatrix,this._matrixTransformMatrix),this._spriteEffect.setMatrixTransform(this._matrixTransformMatrix)},i.prototype.setIgnoreRoundingDestinations=function(e){this._shouldIgnoreRoundingDestinations=e},i.prototype.drawHollowRect=function(e,t,i){void 0===i&&(i=1),this.drawHollowBounds(e.x,e.y,e.width,e.height,t,i)},i.prototype.drawHollowBounds=function(t,i,n,r,o,s){void 0===s&&(s=1);var a=e.Vector2Ext.round(new e.Vector2(t,i)),c=e.Vector2Ext.round(new e.Vector2(t+n,i)),h=e.Vector2Ext.round(new e.Vector2(t+n,i+r)),u=e.Vector2Ext.round(new e.Vector2(t,i+r));this.setIgnoreRoundingDestinations(!0),this.drawLine(a,c,o,s),this.drawLine(c,h,o,s),this.drawLine(h,u,o,s),this.drawLine(u,a,o,s),this.setIgnoreRoundingDestinations(!1)},i.prototype.drawLine=function(e,t,i,n){var r=this._displayObject;r.graphics.lineStyle(n,i),r.graphics.moveTo(e.x,e.y),r.graphics.lineTo(t.x,t.y),r.graphics.endFill()},i.prototype.drawPixel=function(t,i,n){void 0===n&&(n=1);var r=new e.Rectangle(t.x,t.y,n,n);1!=n&&(r.x-=.5*n,r.y-=.5*n);var o=this._displayObject;o.graphics.lineStyle(n,i),o.graphics.drawRect(r.x,r.y,r.width,r.height),o.graphics.endFill()},i.prototype.drawPolygon=function(t,i,n,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=1),!(i.length<2)){this.setIgnoreRoundingDestinations(!0);for(var s=1;s<i.length;s++)this.drawLine(e.Vector2.add(t,i[s-1]),e.Vector2.add(t,i[s]),n,o);r&&this.drawLine(e.Vector2.add(t,i[i.length-1]),e.Vector2.add(t,i[0]),n,o),this.setIgnoreRoundingDestinations(!1)}},i.prototype.drawCircle=function(t,i,n,r,o){void 0===r&&(r=1),void 0===o&&(o=12);var s=e.Vector2.unitX.multiply(new e.Vector2(i)),a=e.Vector2Ext.perpendicularFlip(s);this.setIgnoreRoundingDestinations(!0);for(var c=1;c<=o;c++){var h=e.MathHelper.angleToVector(c*e.MathHelper.PiOver2/o,i),u=e.Vector2Ext.perpendicularFlip(h);this.drawLine(e.Vector2.add(t,s),e.Vector2.add(t,h),n,r),this.drawLine(e.Vector2.subtract(t,s),e.Vector2.subtract(t,h),n,r),this.drawLine(e.Vector2.add(t,a),e.Vector2.add(t,u),n,r),this.drawLine(e.Vector2.subtract(t,a),e.Vector2.subtract(t,u),n,r),s=h,a=u}this.setIgnoreRoundingDestinations(!1)},i.prototype.draw=function(t,i,n,r,o,s,a,c){void 0===n&&(n=16777215),void 0===r&&(r=0),void 0===o&&(o=e.Vector2.zero),void 0===s&&(s=e.Vector2.one),void 0===a&&(a=0),void 0===c&&(c=0),this.checkBegin(),this.pushSprite(t,null,i.x,i.y,s.x,s.y,n,o,r,c,3&a,0,0,0,0)},i.prototype.checkBegin=function(){if(!this._beginCalled)throw new Error("Begin还没有被叫到。在你画画之前，必须先调用Begin")},i.prototype.pushSprite=function(e,t,i,n,r,o,s,a,c,h,u,l,p,d,f){var m,_;if(void 0===t&&(t=null),!this._shouldIgnoreRoundingDestinations&&this.shouldRoundDestinations&&(i=Math.round(i),n=Math.round(n)),t){var g=1/e.textureWidth,y=1/e.textureHeight;t.x*g,t.y*y,m=t.width*g,_=t.height*y,a.x/m*g,a.y/_*y}else 0,0,m=1,_=1,a.x*(1/e.textureWidth),a.y*(1/e.textureHeight);0!=u&&(l*=-1,-1,d*=-1),this._displayObject.texture=e,this._displayObject.x=i,this._displayObject.y=n,this._displayObject.width=r,this._displayObject.height=o,this._displayObject.rotation=c,this._displayObject.skewX=l,this._displayObject.skewY=d},i._cornerOffsetX=[0,1,0,1],i._cornerOffsetY=[0,0,1,1],i}(e.GraphicsResource);e.Batcher=t}(es||(es={})),function(e){var t=function(e){function t(){return e.call(this,t.defaultVert,t.primitive_frag)||this}return __extends(t,e),t.prototype.setMatrixTransform=function(e){this.uniforms.MatrixTransform=e},t.defaultVert="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\nattribute vec4 aColor;\r\n\r\nuniform vec2 projectionVector;\r\n// uniform vec2 offsetVector;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\n\r\nconst vec2 center = vec2(-1.0, 1.0);\r\n\r\nvoid main(void) {\r\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\r\n   vTextureCoord = aTextureCoord;\r\n   vColor = aColor;\r\n}",t.primitive_frag="precision lowp float;\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\n\r\nvoid main(void) {\r\n    gl_FragColor = vColor;\r\n}",t}(egret.CustomFilter);e.SpriteEffect=t}(es||(es={})),function(e){var t=function(){function t(t,i){void 0===i&&(i=null),this.renderId=new e.Ref(null),this.material=e.Material.defaultMaterial,this.renderOrder=0,this.shouldDebugRender=!0,this.camera=i,this.renderOrder=t}return Object.defineProperty(t.prototype,"wantsToRenderToSceneRenderTarget",{get:function(){return null==this.renderTexture},enumerable:!0,configurable:!0}),t.prototype.onAddedToScene=function(e){},t.prototype.unload=function(){this.renderTexture&&this.renderTexture.dispose()},t.prototype.beginRender=function(t){null!=this.renderTexture&&(e.Framework.emitter.emit(e.CoreEvents.setRenderTarget,this.renderTexture),e.Framework.emitter.emit(e.CoreEvents.clearGraphics)),this._currentMaterial=this.material,e.Graphics.instance.batcher.begin(this.renderId,this._currentMaterial.effect,e.Matrix2D.toMatrix(t.transformMatrix))},t.prototype.renderAfterStateCheck=function(t,i){null!=t.material&&t.material!=this._currentMaterial?(this._currentMaterial=t.material,null!=this._currentMaterial.effect&&this._currentMaterial.onPreRender(i),this.flushBatch(i)):null==t.material&&this._currentMaterial!=this.material&&(this._currentMaterial=this.material,this.flushBatch(i)),t.render(e.Graphics.instance.batcher,i)},t.prototype.flushBatch=function(t){e.Graphics.instance.batcher.end(),e.Graphics.instance.batcher.begin(this.renderId,this._currentMaterial.effect,e.Matrix2D.toMatrix(t.transformMatrix))},t.prototype.endRender=function(){e.Graphics.instance.batcher.end()},t.prototype.debugRender=function(t,i){e.Graphics.instance.batcher.end(),e.Graphics.instance.batcher.begin(this.renderId,null,e.Matrix2D.toMatrix(i.transformMatrix));for(var n=0,r=t.entities.buffer;n<r.length;n++){var o=r[n];o.enabled&&o.debugRender(e.Graphics.instance.batcher)}},t.prototype.onSceneBackBufferSizeChanged=function(e,t){this.renderTexture&&(this.renderTexture.$sourceWidth=e,this.renderTexture.$sourceHeight=t)},t.prototype.compare=function(e){return this.renderOrder-e.renderOrder},t}();e.Renderer=t}(es||(es={})),function(e){var t=function(t){function i(e,i){return void 0===e&&(e=0),void 0===i&&(i=null),t.call(this,e,i)||this}return __extends(i,t),i.prototype.render=function(t){var i=this.camera||t.camera;this.beginRender(i);for(var n=0;n<t.renderableComponents.count;n++){var r=t.renderableComponents.get(n);r.enabled&&r.isVisibleFromCamera(i)&&this.renderAfterStateCheck(r,i)}this.shouldDebugRender&&e.Core.debugRenderEndabled&&this.debugRender(t,i),this.endRender()},i}(e.Renderer);e.DefaultRenderer=t}(es||(es={})),function(e){var t=function(){function t(t,i,n){void 0===i&&(i=new e.Rectangle(0,0,t.textureWidth,t.textureHeight)),void 0===n&&(n=i.getHalfSize()),this.uvs=new e.Rectangle,this.texture2D=t,this.sourceRect=i,this.center=new e.Vector2(.5*i.width,.5*i.height),this.origin=n;var r=1/t.textureWidth,o=1/t.textureHeight;this.uvs.x=i.x*r,this.uvs.y=i.y*o,this.uvs.width=i.width*r,this.uvs.height=i.height*o}return t.prototype.clone=function(){return new t(this.texture2D,this.sourceRect,this.origin)},t.spritesFromAtlas=function(e,i,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Number.MAX_VALUE);for(var s=[],a=e.textureWidth/i,c=e.textureHeight/n,h=0,u=new egret.SpriteSheet(e),l=0;l<c;l++)for(var p=0;p<a;p++)if(!(h++<r)){var d=u.getTexture(l+"_"+p);if(d||(d=u.createTexture(l+"_"+p,p*i,l*n,i,n)),s.push(new t(d)),s.length==o)return s}return s},t}();e.Sprite=t}(es||(es={})),function(e){var t=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=!0),this.perviousRenderId=new e.Ref(null),this.sceneLoadAction=t,this.wantsPreviousSceneRender=i,this._loadsNewScene=null!=t,i&&(this.previousSceneRender=new egret.RenderTexture,this.previousSceneRender.drawToTexture(e.Core.Instance))}return Object.defineProperty(t.prototype,"hasPreviousSceneRender",{get:function(){return!!this._hasPreviousSceneRender||(this._hasPreviousSceneRender=!0,!1)},enumerable:!0,configurable:!0}),t.prototype.loadNextScene=function(){var t=this;return __generator(this,function(i){switch(i.label){case 0:return this.onScreenObscured&&this.onScreenObscured(),this._loadsNewScene?[3,2]:(this._isNewSceneLoaded=!0,[4,"break"]);case 1:i.sent(),i.label=2;case 2:this.loadSceneOnBackgroundThread?Promise.resolve(function(){var i=t.sceneLoadAction();e.Core.schedule(0,!1,null,function(n){e.Core.scene=i,t._isNewSceneLoaded=!0})}):(e.Core.scene=this.sceneLoadAction(),this._isNewSceneLoaded=!0),i.label=3;case 3:return this._isNewSceneLoaded?[3,5]:[4,null];case 4:return i.sent(),[3,3];case 5:return[2]}})},t.prototype.onBeginTransition=function(){return __generator(this,function(t){switch(t.label){case 0:return[4,null];case 1:return t.sent(),[4,e.Core.startCoroutine(this.loadNextScene())];case 2:return t.sent(),this.transitionComplete(),[2]}})},t.prototype.preRener=function(e){},t.prototype.render=function(t){t.begin(this.perviousRenderId,null,e.Matrix2D.toMatrix(e.Matrix2D.identity),!1),t.draw(this.previousSceneRender,e.Vector2.zero),t.end()},t.prototype.transitionComplete=function(){e.Core._instance._sceneTransition=null,null!=this.previousSceneRender&&(this.previousSceneRender.dispose(),this.previousSceneRender=null),this.onTransitionCompleted&&this.onTransitionCompleted()},t.prototype.tickEffectProgressProperty=function(t,i,n,r){var o,s,a,c;return void 0===n&&(n=e.EaseType.expoOut),void 0===r&&(r=!1),__generator(this,function(h){switch(h.label){case 0:o=r?1:0,s=r?0:1,a=0,h.label=1;case 1:return a<i?(a+=e.Time.deltaTime,c=e.Lerps.ease(n,o,s,a,i),t.uniforms._progress=c,[4,null]):[3,3];case 2:return h.sent(),[3,1];case 3:return[2]}})},t}();e.SceneTransition=t}(es||(es={})),function(e){var t=function(t){function i(i,n){var r=t.call(this,i,!0)||this;r.maskRenderId=new e.Ref(null),r.duration=1,r.delayBeforeMaskOut=.2,r.minScale=.01,r.maxScale=10,r.scaleEaseType=e.EaseType.expoOut,r.minRotation=0,r.maxRotation=2*Math.PI,r.rotationEaseType=e.EaseType.linear;var o=e.Core.Instance.stage;return r._maskPosition=new e.Vector2(o.stageWidth/2,o.stageHeight/2),r._maskTexture=n,r._maskOrigin=new e.Vector2(r._maskTexture.textureWidth/2,r._maskTexture.textureHeight/2),r}return __extends(i,t),i.prototype.onBeginTransition=function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,null];case 1:i.sent(),t=0,i.label=2;case 2:return t<this.duration?(t+=e.Time.deltaTime,this._renderScale=e.Lerps.ease(this.scaleEaseType,this.maxScale,this.minScale,t,this.duration),this._renderRotation=e.Lerps.ease(this.rotationEaseType,this.minRotation,this.maxRotation,t,this.duration),[4,null]):[3,4];case 3:return i.sent(),[3,2];case 4:return[4,e.Core.startCoroutine(this.loadNextScene())];case 5:return i.sent(),this.previousSceneRender.dispose(),this.previousSceneRender=null,[4,e.Coroutine.waitForSeconds(this.delayBeforeMaskOut)];case 6:i.sent(),t=0,i.label=7;case 7:return t<this.duration?(t+=e.Time.deltaTime,this._renderScale=e.Lerps.ease(e.EaseHelper.oppositeEaseType(this.scaleEaseType),this.minScale,this.maxScale,t,this.duration),this._renderRotation=e.Lerps.ease(e.EaseHelper.oppositeEaseType(this.rotationEaseType),this.maxRotation,this.minRotation,t,this.duration),[4,null]):[3,9];case 8:return i.sent(),[3,7];case 9:return this.transitionComplete(),[2]}})},i.prototype.preRender=function(t){t.begin(this.maskRenderId,null),t.draw(this._maskTexture,this._maskPosition,16777215,this._renderRotation,this._maskOrigin,new e.Vector2(this._renderScale),e.SpriteEffects.none),t.end()},i.prototype.transitionComplete=function(){t.prototype.transitionComplete.call(this),this._maskTexture.dispose(),this._maskRenderTarget.dispose()},i.prototype.render=function(t){this._isNewSceneLoaded||(t.begin(this.perviousRenderId,null),t.draw(this.previousSceneRender,e.Vector2.zero),t.end()),t.begin(this.maskRenderId,null),t.draw(this._maskRenderTarget,e.Vector2.zero),t.end()},i}(e.SceneTransition);e.ImageMaskTransition=t}(es||(es={}));